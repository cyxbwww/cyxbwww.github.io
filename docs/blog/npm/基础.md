# 基础

## 1. 简介

`npm` 有两层含义。一是[Node的开放式模块登记和管理系统](https://www.npmjs.com)。二是Node默认的模块管理器，用来安装和管理Node模块。`npm` 不需要单独安装。在安装Node的时候，会连带一起安装 `npm`，不过可能不是最新版本，可以用下面的命令更新。

``` sh
$ npm install npm@latest -g
```

`@latest` 表示最新版本，`-g` 表示全局安装，命令的主干是 `npm install npm`，即使用 `npm` 安装自己，因为 `npm` 本身与Node其它模块没有区别。查看各种信息：

``` sh
# 查看 npm 命令列表
$ npm help

# 查看各个命令的简单用法
$ npm -l

# 查看 npm 的版本
$ npm -v

# 查看 npm 的配置
$ npm config list -l
```

## 2. `npm init`

`npm init` 用来初始化生成一个新的 `package.json` 文件，使用 `-f` （ force ）或 `-y` （ yes ）直接生成一个新的 `package-json` 文件。

``` sh
$ npm init -y
```

## 3. `npm set`

`npm set` 可以设置环境变量，等于为 `npm init` 设置默认值，以后执行 `npm init`时 `package.json` 的作者姓名、邮箱等字段会自动写入预设值。这些信息保存在用户主目录的 `~/.npmrc` 文件。针对某个项目设置可以使用 `npm config`。

``` sh
$ npm set init-author-name 'cyxbwww'
$ npm set init-author-email '18219326208@163.com'
$ npm set init-author-url 'https://cyxbwww.github.io/'
$ npm set init-license 'MIT'
```

下面的命令可以在安装模块时 `package.json` 文件记录模块的确切版本。

``` sh
$ npm set save-exact true
```

## 4. `npm config`

下面的命令将指定的 `$dir` 目录设为模块的全局安装目录.

``` sh
$ npm config set prefix $dir
```

下面的命令使 `npm install --save` 和 `npm install --save-dev` 安装新模块时，允许的版本范围从克拉符号（`^`）改成波浪号（`~`），即允许小版本升级，变成只允许补丁包升级。

``` sh
$ npm config set save-prefix ~
```

下面的命令指定使用 `npm init` 时生成 `package.json` 文件的字段默认值。

``` sh
$ npm config set init.author.name 'cyxbwww'
$ npm config set init.author.email '18219326208@163.com'
```

## 5. `npm info`

`npm info` 可以查看每个模块的具体信息，如查看 `vue` 模块。

``` sh
$ npm info vue
 
vue@3.2.39 | MIT | deps: 5 | versions: 410
The progressive JavaScript framework for building modern web UI.
https://github.com/vuejs/core/tree/main/packages/vue#readme
 
keywords: vue
 
dist
.tarball: https://registry.npmjs.org/vue/-/vue-3.2.39.tgz
.shasum: de071c56c4c32c41cbd54e55f11404295c0dd62d
.integrity: sha512-tRkguhRTw9NmIPXhzk21YFBqXHT2t+6C6wPOgQ50fcFVWnPdetmRqbmySRHznrYjX2E47u0cGlKGcxKZJ38R/g==
.unpackedSize: 2.6 MB
 
dependencies:
@vue/compiler-dom: 3.2.39    @vue/runtime-dom: 3.2.39     @vue/shared: 3.2.39
@vue/compiler-sfc: 3.2.39    @vue/server-renderer: 3.2.39
 
maintainers:
- yyx990803 <yyx990803@gmail.com>
- posva <posva13@gmail.com>
 
dist-tags:
beta: 3.2.34-beta.1       latest: 3.2.39            next: 3.2.36              v2-beta: 2.7.0-beta.8
csp: 1.0.28-csp           legacy: 2.6.14            v2-alpha: 2.7.0-alpha.12  v2-latest: 2.7.10
 
published a week ago by yyx990803 <yyx990803@gmail.com>
```

返回的详细信息中所有成员都可以直接从 `info` 命令查询。

``` sh
$ npm info vue dependencies
 
{
  '@vue/shared': '3.2.39',
  '@vue/compiler-dom': '3.2.39',
  '@vue/runtime-dom': '3.2.39',
  '@vue/compiler-sfc': '3.2.39',
  '@vue/server-renderer': '3.2.39'
}
```

## 6. `npm install`

从 `npm 5.x` 开始，执行 `npm install` 时会自动生成一个 `package-lock.json` 文件。

`npm` 为了让开发者**在安全的前提下使用最新的依赖包**，在 `package-lock.json` 中做了锁定大版本的操作，这样每次 `npm install` 的时候都会拉取依赖包大版本下的最新的版本。在依赖包有小版本更新时可能会出现协同开发者的依赖包不一致的问题。

`package-lock.json` 文件精确描述了 `node_modules` 目录下所有的包的树状依赖结构，每个包的版本号都是完全精确的。以 `vite` 在 `package-lock.json` 中为例：

``` json
"vite": {
  "version": "3.0.9",
  "resolved": "https://registry.npmjs.org/vite/-/vite-3.0.9.tgz",
  "integrity": "sha512-waYABTM+G6DBTCpYAxvevpG50UOlZuynR0ckTK5PawNVt7ebX6X7wNXHaGIO6wYYFXSM7/WcuFuO2QzhBB6aMw==",
  "dev": true,
  "requires": {
    "esbuild": "^0.14.47",
    "fsevents": "~2.3.2",
    "postcss": "^8.4.16",
    "resolve": "^1.22.1",
    "rollup": ">=2.75.6 <2.77.0 || ~2.77.0"
  },
  "dependencies": {
    "rollup": {
      "version": "2.77.3",
      "resolved": "https://registry.npmjs.org/rollup/-/rollup-2.77.3.tgz",
      "integrity": "sha512-/qxNTG7FbmefJWoeeYJFbHehJ2HNWnjkAFRKzWN/45eNBBF/r8lo992CwcJXEzyVxs5FmfId+vTSTQDb+bxA+g==",
      "dev": true,
      "requires": {
        "fsevents": "~2.3.2"
      }
    }
  }
},
```

`package-lock.json` 的详细描述主要由 `version`、`resolved`、`integrity`、`dev`、`requires`、`dependencies` 这几个字段构成：

- `version`：包唯一的版本号
- `resolved`：安装源
- `integrity`：表明包完整性的 `hash` 值，验证包是否已失效
- `dev`：如果为 `true`，则此依赖关系仅是顶级模块的开发依赖关系或者是一个传递依赖关系
- `requires`：依赖包所需要的所有依赖项，对应依赖包 `package.json` 里 `dependencies` 中的依赖项
- `dependencies`：依赖包 `node_modules` 中依赖的包，与顶层的 `dependencies` 一样的结构

## 7. `npm` 中的依赖包

### 依赖包分类

在 `node` 中有五种依赖：

- dependencies - 业务依赖
- devDependencies - 开发依赖
- peerDependencies - 同伴依赖
- bundledDependencies / bundleDependencies - 打包依赖
- optionalDependencies - 可选依赖

作为 `npm` 的使用者，我们常用的依赖是 `dependencies` 和 `devDependencies`，剩下三种依赖是作为包的发布者才会使用到的字段。
